# Henry EMR é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ (Core Rules v4.14)

<!-- ğŸ“ UPDATED: v4.14 - SPAé·ç§»å¯¾å¿œï¼ˆsubscribeNavigationï¼‰ãƒ«ãƒ¼ãƒ«è¿½åŠ  -->

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¨ã®å”åƒé–‹ç™ºã«ãŠã‘ã‚‹å¿…é ˆãƒ«ãƒ¼ãƒ«é›†ã§ã™ã€‚HenryCore APIã®è©³ç´°ã¯ `henry_core.user.js` å†’é ­ã®APIç›®æ¬¡ã¨å®Ÿè£…ã‚’å‚ç…§ã€‚

---

## 1. AIå”åƒé–‹ç™ºã®ãƒ«ãƒ¼ãƒ« (AI Collaboration Protocol)

### ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ–¹é‡

#### æ›–æ˜§ãªä¾é ¼ã‚’å—ã‘ãŸã¨ãã®æŒ¯ã‚‹èˆã„

æ¨æ¸¬ã§ä½œæ¥­ã‚’é€²ã‚ã‚‹å‰ã«ã€ä»¥ä¸‹ã®è¦³ç‚¹ã§ä¸æ˜ç¢ºãªç‚¹ãŒã‚ã‚Œã°è³ªå•ã™ã‚‹ï¼š

1. **ç›®çš„ãƒ»èƒŒæ™¯**: ãªãœã“ã‚ŒãŒå¿…è¦ã‹ï¼Ÿä½•ã‚’è§£æ±ºã—ãŸã„ã®ã‹ï¼Ÿ
2. **ã‚¹ã‚³ãƒ¼ãƒ—**: ã©ã“ã¾ã§ã‚„ã‚‹ã‹ï¼Ÿæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿ç¯„å›²ã¯ï¼Ÿ
3. **åˆ¶ç´„æ¡ä»¶**: ä½¿ã£ã¦ã¯ã„ã‘ãªã„æŠ€è¡“ã€å¤‰æ›´ã—ã¦ã¯ã„ã‘ãªã„éƒ¨åˆ†
4. **å‡ºåŠ›å½¢å¼**: ã‚³ãƒ¼ãƒ‰ã ã‘ï¼Ÿèª¬æ˜ä»˜ãï¼Ÿãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã®ç²’åº¦ã¯ï¼Ÿ
5. **å„ªå…ˆé †ä½**: é€Ÿåº¦é‡è¦–ï¼Ÿä¿å®ˆæ€§é‡è¦–ï¼Ÿå®Œç’§ã•ã‚ˆã‚Šå‹•ãã‚‚ã®å„ªå…ˆï¼Ÿ

#### è³ªå•ã®ä»•æ–¹

- ä¸€åº¦ã«èãã®ã¯**æœ€å¤§2ã€œ3å€‹**ã«çµã‚‹
- Yes/Noã‚„é¸æŠè‚¢ã§ç­”ãˆã‚‰ã‚Œã‚‹å½¢å¼ã‚’å„ªå…ˆã™ã‚‹
- ã€ŒAã¨Bã©ã¡ã‚‰ãŒã„ã„ã§ã™ã‹ï¼Ÿã€ã€Œâ—‹â—‹ã¨ã„ã†ç†è§£ã§åˆã£ã¦ã„ã¾ã™ã‹ï¼Ÿã€
- è‡ªåˆ†ã®æ¨æ¸¬ã‚„ä»®å®šã‚’ç¤ºã—ãŸä¸Šã§ç¢ºèªã‚’æ±‚ã‚ã‚‹

#### è³ªå•ã™ã¹ãã‚¿ã‚¤ãƒŸãƒ³ã‚°

- è¤‡æ•°ã®å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã€ã©ã‚ŒãŒå¥½ã¿ã‹ä¸æ˜ãªã¨ã
- æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰è¦ç´„ã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ç•°ãªã‚‹æ–¹æ³•ã‚’å–ã‚Šãã†ãªã¨ã
- ä½œæ¥­ç¯„å›²ãŒå¤§ããã€æ–¹å‘æ€§ã‚’é–“é•ãˆã‚‹ã¨æ‰‹æˆ»ã‚ŠãŒå¤§ãã„ã¨ã
- è¦ä»¶ã«çŸ›ç›¾ã‚„ä¸æ•´åˆãŒã‚ã‚Šãã†ãªã¨ã

#### è³ªå•ã—ãªãã¦ã‚ˆã„ã¨ã

- æ˜ã‚‰ã‹ã«äº›ç´°ãªå®Ÿè£…è©³ç´°ï¼ˆå¤‰æ•°åã®ç´°ã‹ã„é•ã„ãªã©ï¼‰
- éå»ã®ä¼šè©±ã‚„ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰åˆ¤æ–­ã§ãã‚‹ã“ã¨
- æ¨™æº–çš„ãªãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§å¯¾å¿œã§ãã‚‹ã“ã¨

#### ä½œæ¥­å‰ã®ç¢ºèªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

å¤§ãã‚ã®ã‚¿ã‚¹ã‚¯ã‚’å§‹ã‚ã‚‹å‰ã«ã€ä»¥ä¸‹ã‚’ç°¡æ½”ã«æç¤ºã—ã¦ç¢ºèªã‚’å–ã‚‹ï¼š

```
ã€ç†è§£ã—ãŸå†…å®¹ã€‘
- ç›®çš„: â—‹â—‹
- ã‚„ã‚‹ã“ã¨: â—‹â—‹
- ã‚„ã‚‰ãªã„ã“ã¨: â—‹â—‹
- ä½¿ã†æŠ€è¡“/ãƒ‘ã‚¿ãƒ¼ãƒ³: â—‹â—‹

ã“ã‚Œã§é€²ã‚ã¦ã‚ˆã„ã§ã™ã‹ï¼Ÿ
```

#### ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®æ±‚ã‚æ–¹

ä½œæ¥­å®Œäº†å¾Œã€å¿…è¦ã«å¿œã˜ã¦ï¼š
- ã€ŒæœŸå¾…ã¨é•ã†ç‚¹ãŒã‚ã‚Œã°æ•™ãˆã¦ãã ã•ã„ã€
- ã€Œã“ã®æ–¹é‡ã§ä»–ã®éƒ¨åˆ†ã‚‚é€²ã‚ã¦ã‚ˆã„ã§ã™ã‹ï¼Ÿã€

ä½œæ¥­ä¸­ã¯ã€è¦æ‰€ã§ã€Œä½•ã‚’ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã‹ã€ã€Œãªãœãã†ã™ã‚‹ã®ã‹ã€ã‚’ç°¡æ½”ã«èª¬æ˜ã™ã‚‹ã“ã¨ã€‚

#### ã‚¯ãƒ©ãƒƒã‚·ãƒ¥å ±å‘Šæ™‚ã®å¯¾å¿œ

**YOU MUST**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€Œã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãŸã€ã¨å ±å‘Šã‚’å—ã‘ãŸå ´åˆã¯ã€ã¾ãš (1) ã©ã“ã¾ã§ä½œæ¥­ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã€(2) æ®‹ã‚Šã®ä½œæ¥­ã‚’æ˜ç¢ºã«ã—ã¦ã‹ã‚‰å†é–‹ã™ã‚‹ã“ã¨ã€‚

### ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã®æ›´æ–°

**YOU MUST**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æ–°ã—ã„ãƒ«ãƒ¼ãƒ«ã®è¿½åŠ æŒ‡ç¤ºãŒã‚ã£ãŸå ´åˆã€å¿…ãš **ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜ã™ã‚‹ã“ã¨ã€‚

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆéšå±¤ (Instruction Hierarchy)

æŒ‡ç¤ºã®é‡è¦åº¦ã¯3æ®µéšã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼š

#### NEVERï¼ˆçµ¶å¯¾ç¦æ­¢ï¼‰

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å®‰å…¨æ€§ã®å¢ƒç•Œã€‚ä¾‹å¤–ãªã—ã€‚

- PIIï¼ˆå€‹äººæƒ…å ±ï¼‰ã‚’ `localStorage`, `IndexedDB`, `GM_setValue` ã«å¹³æ–‡ä¿å­˜ã—ã¦ã¯ãªã‚‰ãªã„
- ãƒˆãƒ¼ã‚¯ãƒ³ç­‰ã®ç§˜åŒ¿æƒ…å ±ã‚’ `console.log` ã«å‡ºåŠ›ã—ã¦ã¯ãªã‚‰ãªã„
- `.sc-xxxx` ãªã©ã®ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¯ãƒ©ã‚¹åã‚„ XPath ã‚’ã‚»ãƒ¬ã‚¯ã‚¿ã«ä½¿ç”¨ã—ã¦ã¯ãªã‚‰ãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãªã—ã§ã®è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚„ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¥ªå–ã‚’ã—ã¦ã¯ãªã‚‰ãªã„

#### YOU MUSTï¼ˆå¿…é ˆè¦ä»¶ï¼‰

åŸºæœ¬çš„ã«éµå®ˆã™ã¹ãè¦ä»¶ã€‚ä¾‹å¤–ã¯ç¨€ã€‚

- ã‚¨ãƒ©ãƒ¼æ™‚ã¯å¿…ãš `console.error('[SCRIPT_NAME]', ...)` ã§åŸå› ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨
- SPAé·ç§»æ™‚ã«ã¯å…¨ã¦ã® MutationObserverã€ã‚¿ã‚¤ãƒãƒ¼ã€AbortController ã‚’ç ´æ£„ã™ã‚‹ã“ã¨
- APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã‚¨ãƒ©ãƒ¼/æƒ³å®šå¤–/null ã®å ´åˆã¯å³åœæ­¢ã™ã‚‹ã“ã¨ï¼ˆå†è©¦è¡Œã—ãªã„ï¼‰
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¯ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆx.y.zï¼‰ã«å¾“ã†ã“ã¨
- `@match https://henry-app.jp/*` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨

#### IMPORTANTï¼ˆé‡è¦ãªè€ƒæ…®äº‹é …ï¼‰

æ¨å¥¨äº‹é …ã€‚çŠ¶æ³ã«å¿œã˜ãŸåˆ¤æ–­ã¯è¨±å®¹ã€‚

- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚ã€ä¸€åº¦ã ã‘å¾…ã¤ãªã‚‰ `waitForElement` ã‚’æ¨å¥¨
- DOMä¾å­˜ã‚’é¿ã‘ã€`HenryCore` APIçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’æ¨å¥¨
- ç´”ç²‹é–¢æ•°ã¨ã—ã¦åˆ‡ã‚Šå‡ºã™ã“ã¨ã§ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’å‘ä¸Š
- `data-testid`ã€`role`ã€`aria-*` å±æ€§ã®ä½¿ç”¨ã‚’æ¨å¥¨

### ã‚³ãƒ¼ãƒ‰å‡ºåŠ›ã®åˆ¶ç´„ (Code Generation Protocol)

**åŸå‰‡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æ˜ç¤ºçš„ãªæŒ‡ç¤ºï¼ˆä¾‹ï¼šã€Œã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã€ã€Œå®Ÿè£…ã—ã¦ã€ï¼‰ãŒã‚ã‚‹ã¾ã§ã€ã‚³ãƒ”ãƒ¼ï¼†ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã®ã¾ã¾ä½¿ãˆã‚‹ã€Œå®Œå…¨ãªå®Ÿè£…ã‚³ãƒ¼ãƒ‰ã€ã‚’å‡ºåŠ›ã—ã¦ã¯ãªã‚‰ãªã„ã€‚

**YOU MUST**: ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å‰ã«ã€ã¾ãšä¿®æ­£å†…å®¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªã™ã‚‹ã“ã¨ã€‚ç¢ºèªãªã—ã«ç›´æ¥ç·¨é›†ã—ãªã„ã€‚

**ç¦æ­¢äº‹é …**: è­°è«–ã®é€”ä¸­ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ±‚ã‚ã¦ã„ãªã„ã®ã«ã€Œä¿®æ­£ã—ãŸå…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã§ã™ã€ã¨é•·ã„ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’æç¤ºã™ã‚‹ã“ã¨ã€‚

**ä¾‹å¤–ï¼ˆè¨±å¯ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ï¼‰**: ãƒ­ã‚¸ãƒƒã‚¯ã‚„å‡¦ç†ã®æµã‚Œã‚’èª¬æ˜ã™ã‚‹ãŸã‚ã®çŸ­ã„ã‚³ãƒ¼ãƒ‰ç‰‡ï¼ˆæ•°è¡Œç¨‹åº¦ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼‰ã‚„ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰ã¯ã€ç†è§£ã‚’åŠ©ã‘ã‚‹ãŸã‚ã«ç©æ¥µçš„ã«æç¤ºã—ã¦ã‚ˆã„ã€‚

**åˆ¤æ–­åŸºæº–**:

- âœ… OK: ã€Œä¾‹ãˆã°ã€ã“ã®ã‚ˆã†ã« `filter` ã‚’ä½¿ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€ã¨ã„ã£ãŸèª¬æ˜ç”¨ã®æŠœç²‹
- âŒ NG: ã€Œä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨ä½“ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€ã¨ã„ã£ãŸå®Œæˆå“ã®æç¤ºï¼ˆæŒ‡ç¤ºãŒã‚ã‚‹ã¾ã§å¾…æ©Ÿï¼‰

### ã‚³ãƒ¼ãƒ‰å‡ºåŠ›ã®é †åº (Code Output Order)

**åŸå‰‡**: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’å‡ºåŠ›ã™ã‚‹éš›ã¯ã€èª¬æ˜æ–‡ã‚’**å…ˆã«**ã€ã‚³ãƒ¼ãƒ‰ã‚’**æœ€å¾Œã«**é…ç½®ã™ã‚‹ã€‚ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å¾Œã«èª¬æ˜æ–‡ã‚’æ›¸ã‹ãªã„ã€‚

**ç†ç”±**: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å¾Œã«èª¬æ˜æ–‡ãŒã‚ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ”ãƒšã™ã‚‹éš›ã«ä½™è¨ˆãªãƒ†ã‚­ã‚¹ãƒˆãŒæ··å…¥ã—ã€ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼ã®åŸå› ã¨ãªã‚‹ã€‚

**åˆ¤æ–­åŸºæº–**:

- âœ… OK: èª¬æ˜ â†’ å¤‰æ›´ç‚¹ â†’ ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆçµ‚äº†ï¼‰
- âŒ NG: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ â†’ å¤‰æ›´ç‚¹ â†’ èª¬æ˜

---

## 2. Henryé–‹ç™ºã®å¿…é ˆãƒ«ãƒ¼ãƒ« (Core Development Rules)

### éä¾µå…¥å‹UXã®å¾¹åº•

**IMPORTANT**: ã€Œã¼ã‹ã—ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã€ç­‰ã®è¦–è¦šåŠ¹æœã‚’ä¼´ã†ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯æ“ä½œã‚’èµ·ç‚¹ã¨ã™ã‚‹å ´åˆã®ã¿è¨±å¯ã€‚

### åœæ­¢ã®åŸå‰‡ã¨ãƒ­ã‚°ã®åˆ‡ã‚Šåˆ†ã‘

| è¦–ç‚¹ | ãƒ«ãƒ¼ãƒ« |
|------|--------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ | UIã‚’å‡ºã•ãªã„ã€æ“ä½œã‚’ç¶™ç¶šã•ã›ãªã„ï¼ˆæ²ˆé»™ã—ã¦åœæ­¢ï¼‰ |
| é–‹ç™ºè€…è¦–ç‚¹ | `console.error` ã§åŸå› ã‚’ç‰¹å®šå¯èƒ½ã«ã™ã‚‹ |

**è£œè¶³ï¼šåœæ­¢ã®çµ±ä¸€ãƒ«ãƒ¼ãƒ«**

- APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒã‚¨ãƒ©ãƒ¼ / æƒ³å®šå¤–ã®å½¢å¼ / null ã®å ´åˆã‚‚å³åœæ­¢ï¼ˆå†è©¦è¡Œã—ãªã„ï¼‰
- ã€Œé™ã‹ã«çµ‚äº†ã€= Promise ã¯ `resolve(null)` ã§æ­£å¸¸çµ‚äº†ã•ã›ã€å‘¼ã³å‡ºã—å…ƒã§ null ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã«ã¯å¿…ãš `[SCRIPT_NAME]` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ã‚‹
- åŒä¸€ã‚¨ãƒ©ãƒ¼ã¯1å›ã ã‘å‡ºåŠ›ã™ã‚‹ï¼ˆãƒ«ãƒ¼ãƒ—å†…ã§ã®é€£æ‰“ç¦æ­¢ï¼‰

### PIIï¼ˆå€‹äººæƒ…å ±ï¼‰ã®æ°¸ç¶šåŒ–ç¦æ­¢

**NEVER**: `localStorage`, `IndexedDB`, `GM_setValue` ç­‰ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã€æ‚£è€…ã®æ°åãƒ»é€£çµ¡å…ˆãƒ»ã‚«ãƒ«ãƒ†å†…å®¹ãªã©ã®å€‹äººæƒ…å ±ã‚’å¹³æ–‡ã§ä¿å­˜ã™ã‚‹ã“ã¨ã€‚

**IMPORTANT**: ä¸€æ™‚çš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¿…è¦ãªå ´åˆã¯ã€ãƒ¡ãƒ¢ãƒªä¸Šã®å¤‰æ•°ï¼ˆTTLCacheãªã©ï¼‰ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚

### ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**YOU MUST**: SPAé·ç§»æ™‚ï¼ˆ`henry:navigation` / `popstate`ï¼‰ã«ã¯ã€å…¨ã¦ã® MutationObserverã€ã‚¿ã‚¤ãƒãƒ¼ã€éåŒæœŸå‡¦ç†ã‚’å®Œå…¨ã«ç ´æ£„ã™ã‚‹ã“ã¨ã€‚

**ä½¿ç”¨ã™ã‚‹API**:
- `utils.createCleaner()` - ç ´æ£„å¯¾è±¡ã®ä¸€æ‹¬ç®¡ç†
- `utils.subscribeNavigation()` - ç”»é¢é·ç§»æ™‚ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

å®Ÿè£…ä¾‹ã¯ `henry_core.user.js` ã‚’å‚ç…§ã€‚

---

## 3. åŸºæœ¬çš„ãªã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ (Essential Patterns)

### ã‚»ãƒ¬ã‚¯ã‚¿æˆ¦ç•¥

**YOU MUST**: `data-testid`ã€`role`ã€`aria-*` å±æ€§ã€ã¾ãŸã¯ä¸å¤‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’åŸºæº–ã«ã™ã‚‹ã“ã¨ã€‚

**IMPORTANT**: ãƒ¢ãƒ¼ãƒ€ãƒ«ç­‰ã¯ `document.body` ç›´ä¸‹ã«ç¾ã‚Œã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒŠå¤–ã¸ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨±å®¹ã™ã‚‹è¨­è¨ˆã«ã™ã‚‹ã“ã¨ã€‚

### HenryCore ä½¿ç”¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

**å‰ææ¡ä»¶**: HenryCore ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå…ˆã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚

#### ä½¿ç”¨ã™ã¹ãå ´é¢

| å ´é¢ | ä½¿ç”¨ã™ã‚‹API | ç†ç”± |
|------|------------|------|
| GraphQLå‘¼ã³å‡ºã— | `query()` | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè‡ªå‹•åˆ¤åˆ¥ã€ã‚¨ãƒ©ãƒ¼è‡ªå‹•ãƒ­ã‚° |
| æ‚£è€…UUIDå–å¾— | `getPatientUuid()` | DOMè§£æã‚ˆã‚Šç¢ºå®Ÿã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œã‚’å›é¿ |
| SPAé·ç§»æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— | `utils.createCleaner()` | ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ»äºŒé‡å®Ÿè¡Œé˜²æ­¢ |
| ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç™»éŒ² | `registerPlugin()` | Toolboxè‡ªå‹•é€£æº |
| Google APIé€£æº | `modules.GoogleAuth` | ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®ä¸€å…ƒåŒ– |

#### ç¦æ­¢äº‹é …

**NEVER**:
- ç›´æ¥ `fetch()` ã§GraphQL APIã‚’å‘¼ã¶ â†’ `query()` ã‚’ä½¿ã†
- URLã‚„DOMã‹ã‚‰æ‚£è€…UUIDã‚’è§£æã™ã‚‹ â†’ `getPatientUuid()` ã‚’ä½¿ã†
- `HenryToolbox.register()` ã‚’ç›´æ¥å‘¼ã¶ â†’ `registerPlugin()` ã‚’ä½¿ã†
- ãƒˆãƒ¼ã‚¯ãƒ³ç­‰ã®ç§˜åŒ¿æƒ…å ±ã‚’ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹
- ãƒãƒƒã‚·ãƒ¥æ–¹å¼ï¼ˆAPQï¼‰ã§GraphQL APIã‚’å‘¼ã¶ â†’ ãƒ•ãƒ«ã‚¯ã‚¨ãƒªæ–¹å¼ã‚’ä½¿ã†

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**YOU MUST**: `query()` ã¯å¤±æ•—æ™‚ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ã€‚try-catchã§å‡¦ç†ã—ã€é™ã‹ã«çµ‚äº†ã™ã‚‹ã“ã¨ã€‚

```javascript
try {
  const result = await HenryCore.query(QUERY, { input: { uuid } });
  if (!result.data?.getPatient) return null;
} catch (e) {
  console.error('[SCRIPT_NAME]', e.message);
  return null;
}
```

#### APIè©³ç´°

`henry_core.user.js` å†’é ­ã®APIç›®æ¬¡ã¨å„é–¢æ•°ã®å®Ÿè£…ã‚’å‚ç…§ã€‚

### SPAé·ç§»å¯¾å¿œï¼ˆå¿…é ˆï¼‰

**YOU MUST**: Henryæœ¬ä½“ï¼ˆhenry-app.jpï¼‰ã§å‹•ä½œã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€`subscribeNavigation` ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚

```javascript
const cleaner = HenryCore.utils.createCleaner();

function init() {
  // ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
  const observer = new MutationObserver(callback);
  observer.observe(target, options);

  // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ç™»éŒ²
  cleaner.add(() => observer.disconnect());
}

HenryCore.utils.subscribeNavigation(cleaner, init);
```

**ç†ç”±**: Henryã¯SPAã®ãŸã‚ã€ãƒšãƒ¼ã‚¸é·ç§»ã—ã¦ã‚‚ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œãªã„ã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ãªã„ã¨ã€Observer/ã‚¿ã‚¤ãƒãƒ¼/ãƒªã‚¹ãƒŠãƒ¼ãŒæ®‹ã‚Šç¶šã‘ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚„äºˆæœŸã—ãªã„å‹•ä½œã®åŸå› ã¨ãªã‚‹ã€‚

**ä¾‹å¤–**:
- ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆhenry_login_helper.user.jsï¼‰
- éSPAã‚µã‚¤ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆreserve_*.user.jsï¼‰

### Tampermonkey ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

#### ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å¯¾ç­–

**YOU MUST**: `@grant GM_*` ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€`@grant unsafeWindow` ã‚‚è¿½åŠ ã—ã€`unsafeWindow` çµŒç”±ã§ HenryCore ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã€‚

```javascript
const pageWindow = typeof unsafeWindow !== 'undefined' ? unsafeWindow : window;
const core = pageWindow.HenryCore;
```

#### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¨­å®š

**YOU MUST**: æ–°è¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆæ™‚ã¯ä»¥ä¸‹ã‚’è¨­å®šã™ã‚‹ã“ã¨ï¼š
- `@updateURL` ã¨ `@downloadURL` ã«GitHub raw URLï¼ˆ`https://raw.githubusercontent.com/shin-926/Henry/main/<filename>.user.js`ï¼‰
- `@version` ã‚’ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°å½¢å¼ï¼ˆx.y.zï¼‰

**YOU MUST**: ã‚³ãƒŸãƒƒãƒˆæ™‚ã¯ `@version` ã‚’æ›´æ–°ï¼ˆãƒã‚°ä¿®æ­£: ãƒ‘ãƒƒãƒã€æ©Ÿèƒ½è¿½åŠ : ãƒã‚¤ãƒŠãƒ¼ã€ç ´å£Šçš„å¤‰æ›´: ãƒ¡ã‚¸ãƒ£ãƒ¼ï¼‰

---

## 4. ãƒ‡ãƒãƒƒã‚°ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (Debug & Workflow)

### ãƒ‡ãƒãƒƒã‚°æ‰‹é †ï¼ˆåŸå› ç©¶æ˜ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰

1. **ç¾çŠ¶æŠŠæ¡**: ãƒ­ã‚°ã®ç¢ºèªã€ç„¡è¨€åœæ­¢ã®ç¢ºèª
2. **è¦å› åˆ‡ã‚Šåˆ†ã‘**: DOMå¤‰åŒ–ã€éåŒæœŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ
3. **ä»®èª¬æ¤œè¨¼**: æ ¹æ‹ ã®ã‚ã‚‹ä¿®æ­£ã®ã¿ã‚’è¡Œã†

**YOU MUST**: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯ã€æ¨æ¸¬ã§åˆ¥ã®å¯èƒ½æ€§ã‚’ææ¡ˆã™ã‚‹å‰ã«ã€ã¾ãšå®Ÿéš›ã®ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’èª¿æŸ»ã™ã‚‹ã“ã¨ã€‚APIã‚¨ãƒ©ãƒ¼ãªã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’ç¢ºèªã—ã€å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åŸºã¥ã„ã¦ä¿®æ­£ã™ã‚‹ã€‚

### æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

**Explore â†’ Plan â†’ Code â†’ Commit**

1. **Explore**: é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã€æ—¢å­˜ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç†è§£
2. **Plan**: è©³ç´°ãªå®Ÿè£…è¨ˆç”»ã‚’ç«‹ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèª
3. **Code**: è¨ˆç”»ã«åŸºã¥ã„ã¦å®Ÿè£…
4. **Commit**: ãƒ†ã‚¹ãƒˆãƒ»ç¢ºèªå¾Œã«ã‚³ãƒŸãƒƒãƒˆ

**IMPORTANT**: æ¢ç´¢ãƒ»è¨ˆç”»ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ç›´æ¥ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¨å“è³ªãŒä½ä¸‹ã™ã‚‹ã€‚

### å•é¡Œè§£æ±ºã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ (Problem-Solving Approach)

è¤‡é›‘ãªå•é¡Œã«å–ã‚Šçµ„ã‚€éš›ã¯ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ˜ç¤ºçš„ã«è¸ã‚€ã“ã¨ï¼š

1. **å•é¡Œã®åˆ†è§£**: å¤§ããªå•é¡Œã‚’å°ã•ãªéƒ¨åˆ†å•é¡Œã«åˆ†ã‘ã‚‹
2. **ä»®å®šã®æ˜ç¤º**: å‰ææ¡ä»¶ã‚„åˆ¶ç´„ã‚’è¨€èªåŒ–ã™ã‚‹
3. **è¤‡æ•°æ¡ˆã®æ¤œè¨**: 1ã¤ã®è§£æ³•ã«é£›ã³ã¤ã‹ãšã€å°‘ãªãã¨ã‚‚2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¯”è¼ƒã™ã‚‹
4. **æ®µéšçš„ãªæ¤œè¨¼**: å„ã‚¹ãƒ†ãƒƒãƒ—ã®çµæœã‚’ç¢ºèªã—ã¦ã‹ã‚‰æ¬¡ã¸é€²ã‚€

**IMPORTANT**: ã€Œã¨ã‚Šã‚ãˆãšå‹•ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã€å‰ã«ã€ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµŒã‚‹ã“ã¨ã€‚ç‰¹ã«ä»¥ä¸‹ã®å ´åˆã¯å¿…é ˆï¼š
- ãƒã‚°ã®åŸå› ãŒä¸æ˜ãªã¨ã
- è¤‡æ•°ã®å®Ÿè£…æ–¹æ³•ãŒã‚ã‚‹ã¨ã
- è¦ä»¶ãŒè¤‡é›‘ã¾ãŸã¯æ›–æ˜§ãªã¨ã

**ç†ç”±**: ä¸­é–“æ¨è«–ã‚’æ˜ç¤ºã™ã‚‹ã“ã¨ã§è«–ç†ã®é£›èºã‚’é˜²ãã€æ‰‹æˆ»ã‚Šã‚’æ¸›ã‚‰ã™ã€‚

---

## 5. å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (Reference)

### HenryCore API

`henry_core.user.js` å†’é ­ã®APIç›®æ¬¡ã¨å„é–¢æ•°ã®å®Ÿè£…ã‚’å‚ç…§ã€‚

**YOU MUST**: APIã‚’å¤‰æ›´ãƒ»è¿½åŠ ã—ãŸå ´åˆã¯ã€`henry_core.user.js` å†’é ­ã®APIç›®æ¬¡ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã€‚

### GraphQL API

chrome-devtools-mcpã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æŸ»ã€‚é™çš„ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã¯å»ƒæ­¢ã€‚

### èª¿æŸ»ãƒ¡ãƒ¢ãƒ»å®Ÿè£…è©³ç´°

`NOTES.md` - èª¿æŸ»çµæœã€APIä»•æ§˜ãƒ¡ãƒ¢ã€å®Ÿè£…è©³ç´°ãªã©ã€‚ä¿ç•™ã‚¿ã‚¹ã‚¯ã®è©³ç´°æƒ…å ±ã‚‚ã“ã“ã«è¨˜è¼‰ã€‚

### chrome-devtools-mcpï¼ˆãƒ–ãƒ©ã‚¦ã‚¶é€£æºï¼‰

`NOTES.md` ã®ã€Œchrome-devtools-mcp èµ·å‹•æ‰‹é †ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã€‚

**æ©Ÿèƒ½**: Claude CodeãŒãƒ–ãƒ©ã‚¦ã‚¶ã‚’ç›´æ¥æ“ä½œãƒ»ç›£è¦–ã§ãã‚‹
- DOMç¢ºèªã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã€ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆGraphQL APIèª¿æŸ»ï¼‰
- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã®ç¢ºèªï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå‹•ä½œç¢ºèªï¼‰

**YOU MUST**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€Œchrome-devtoolsã®èµ·å‹•æ–¹æ³•ã€ã‚’èã‹ã‚ŒãŸã‚‰ã€`NOTES.md` ã®æ‰‹é †ã‚’å‚ç…§ã—ã¦å›ç­”ã™ã‚‹ã“ã¨ã€‚

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

**YOU MUST**: å…¨ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ï¼ˆx.y.zï¼‰ã«å¾“ã†ã“ã¨ã€‚

**YOU MUST**: Henry Core ã®ä»•æ§˜å¤‰æ›´ã«å¯¾å¿œã—ãŸå ´åˆã¯ã€å¿…ãšãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹ã“ã¨ï¼ˆä¾‹: ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ z ã®åŠ ç®—ï¼‰ã€‚

---

## 6. ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ« (Custom Rules)

> **ğŸ“ ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯è¿½è¨˜å°‚ç”¨**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ«ãƒ¼ãƒ«ã‚„ã€é–‹ç™ºä¸­ã«è¿½åŠ ã—ãŸã„ãƒ«ãƒ¼ãƒ«ã‚’ã“ã“ã«è¨˜è¼‰ã—ã¾ã™ã€‚

### è¿½åŠ ãƒ«ãƒ¼ãƒ«

- **IMPORTANT**: ã‚³ãƒ¼ãƒ‰å›ºæœ‰ã®èª²é¡Œã‚„TODOã¯ã€è©²å½“ã‚³ãƒ¼ãƒ‰å†…ã«TODOã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã™ã“ã¨ï¼ˆä¾‹: `// TODO: å‹•ä½œç¢ºèªå¾Œã«ã“ã®ãƒ­ã‚°ã‚’å‰Šé™¤`ï¼‰

- **IMPORTANT**: ä½œæ¥­å®Œäº†å¾Œã€ä¸€æ®µä¸Šã®è¦–ç‚¹ï¼ˆãƒ¡ã‚¿ãªè¦–ç‚¹ï¼‰ã‹ã‚‰å½±éŸ¿ç¯„å›²ã‚’ç¢ºèªã—ã€å¿…è¦ãªè¿½åŠ ä½œæ¥­ãŒã‚ã‚Œã°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ææ¡ˆã™ã‚‹ã“ã¨ã€‚ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»è¨­è¨ˆæ–¹é‡ãƒ»é‹ç”¨ãƒ•ãƒ­ãƒ¼ãƒ»å‘½åè¦å‰‡ãªã©ã€ã‚ã‚‰ã‚†ã‚‹å´é¢ã§æ•´åˆæ€§ã‚’è€ƒãˆã‚‹ã€‚

- **YOU MUST**: APIã‚’ä½¿ç”¨ã™ã‚‹å‰ã«ã€å¿…ãšä»•æ§˜ã‚’ç¢ºèªã™ã‚‹ã“ã¨ï¼š
  - GraphQL API â†’ chrome-devtools-mcpã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ èª¿æŸ»ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼‰
  - HenryCore API â†’ `henry_core.user.js` å†’é ­ã®APIç›®æ¬¡ã¨å®Ÿè£…ã‚’ç¢ºèªï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã€é–¢æ•°ã®æœ‰ç„¡ãªã©ï¼‰
  - **æ¨æ¸¬ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªã„ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚ˆã‚Šç¢ºèªã®æ­£ç¢ºã•ã‚’å„ªå…ˆã™ã‚‹**

- **YOU MUST**: OAuthèªè¨¼ãŒå¿…è¦ãªå ´åˆã¯ã€`alert()` ã§ç†ç”±ã‚’ä¼ãˆã¦ã‹ã‚‰è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚„èªè¨¼ç”»é¢ã‚’é–‹ãã“ã¨ï¼š
  ```javascript
  // OAuthè¨­å®šãŒæœªå®Œäº†ã®å ´åˆ
  if (!googleAuth?.isConfigured()) {
    alert('OAuthè¨­å®šãŒå¿…è¦ã§ã™ã€‚è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ãã¾ã™ã€‚');
    googleAuth?.showConfigDialog();
    return;
  }
  // èªè¨¼ãŒæœªå®Œäº†ã®å ´åˆ
  if (!googleAuth?.isAuthenticated()) {
    alert('Googleèªè¨¼ãŒå¿…è¦ã§ã™ã€‚èªè¨¼ç”»é¢ã‚’é–‹ãã¾ã™ã€‚');
    googleAuth?.startAuth();
    return;
  }
  ```
  - ã„ããªã‚Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ··ä¹±ã™ã‚‹ãŸã‚ã€å…ˆã«ç†ç”±ã‚’ä¼ãˆã‚‹

- **IMPORTANT**: GraphQL mutationã§å¤‰æ•°å‹ï¼ˆ`$input: SomeInput!`ï¼‰ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å ´åˆã¯ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ–¹å¼ã‚’ä½¿ã†ã“ã¨ï¼š
  ```javascript
  // NG: å¤‰æ•°å‹ï¼ˆã‚µãƒ¼ãƒãƒ¼ãŒå‹ã‚’å…¬é–‹ã—ã¦ã„ãªã„å ´åˆã‚¨ãƒ©ãƒ¼ï¼‰
  const MUTATION = `mutation Update($input: UpdateInput!) { update(input: $input) { ... } }`;
  await HenryCore.query(MUTATION, { input: data });
  
  // OK: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ–¹å¼ï¼ˆå€¤ã‚’ç›´æ¥åŸ‹ã‚è¾¼ã‚€ï¼‰
  const MUTATION = `mutation { update(input: { field: "${value}", num: ${num} }) { ... } }`;
  await HenryCore.query(MUTATION);
  ```
  - è©³ç´°ã¯ `NOTES.md` ã®ã€ŒGraphQL ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ–¹å¼ã€ã‚’å‚ç…§

---

## å¤‰æ›´å±¥æ­´

| Version | Date | Changes |
|---------|------|---------|
| v4.14 | 2026-01-14 | SPAé·ç§»å¯¾å¿œï¼ˆsubscribeNavigationï¼‰ãƒ«ãƒ¼ãƒ«è¿½åŠ  |
| v4.13 | 2026-01-13 | GraphQL ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ–¹å¼ãƒ«ãƒ¼ãƒ«è¿½åŠ  |
| v4.12 | 2026-01-13 | OAuthèªè¨¼æ™‚ã¯alertã§ç†ç”±ã‚’ä¼ãˆã‚‹ãƒ«ãƒ¼ãƒ«è¿½åŠ  |
| v4.11 | 2026-01-12 | ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚ˆã‚Šç¢ºèªã®æ­£ç¢ºã•ã‚’å„ªå…ˆã™ã‚‹ãƒ«ãƒ¼ãƒ«è¿½åŠ  |
| v4.10 | 2026-01-12 | APIä½¿ç”¨å‰ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ç¢ºèªãƒ«ãƒ¼ãƒ«è¿½åŠ ï¼ˆGraphQL/HenryCoreä¸¡æ–¹ï¼‰ |
| v4.9 | 2026-01-12 | ã‚¿ã‚¹ã‚¯IDé‹ç”¨ãƒ«ãƒ¼ãƒ«è¿½åŠ ã€ãƒ¡ã‚¿è¦–ç‚¹ç¢ºèªãƒ«ãƒ¼ãƒ«è¿½åŠ  |
| v4.8 | 2026-01-12 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹é€ ç°¡ç•¥åŒ–ã€èª¿æŸ»ãƒ¡ãƒ¢ã‚’NOTES.mdã«åˆ†é›¢ |
| v4.7 | 2026-01-11 | å•é¡Œè§£æ±ºã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒè¿½åŠ  |
| v4.4 | 2026-01-08 | ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ–¹é‡ã‚’è©³ç´°åŒ– |
| v4.0 | 2026-01-04 | ãƒ«ãƒ¼ãƒ«ã¨ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’åˆ†é›¢ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆéšå±¤å°å…¥ |

> è©³ç´°ãªå¤‰æ›´å±¥æ­´ã¯ `git log` ã‚’å‚ç…§ã€‚

---

## ğŸ”” ä¿ç•™ä¸­ã®ã‚¿ã‚¹ã‚¯ (Pending Tasks)

> **AIå‘ã‘æŒ‡ç¤º**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«ç¢ºèªã—ã€æœªå®Œäº†ã‚¿ã‚¹ã‚¯ã‚’ãƒªãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ã“ã¨ã€‚ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã¯ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã€‚
>
> **ã‚¿ã‚¹ã‚¯IDé‹ç”¨ãƒ«ãƒ¼ãƒ«**:
> - æ–°è¦ã‚¿ã‚¹ã‚¯è¿½åŠ æ™‚ã¯ `TASK-XXX` å½¢å¼ã®IDã‚’æŒ¯ã‚‹ï¼ˆé€£ç•ªï¼‰
> - è©³ç´°ãŒå¿…è¦ãªã‚¿ã‚¹ã‚¯ã¯ `NOTES.md` ã«åŒã˜IDã§è¦‹å‡ºã—ã‚’ä½œæˆ
> - ã“ã‚Œã«ã‚ˆã‚Šä¸¡ãƒ•ã‚¡ã‚¤ãƒ«é–“ã§ `TASK-XXX` ã§æ¤œç´¢ã—ã¦å¯¾å¿œã‚’å–ã‚Œã‚‹

### èª¿æŸ»ãƒ»é–‹ç™ºã‚¿ã‚¹ã‚¯
- [ ] TASK-001: ORDER_STATUS_REVOKED ã®æ‰¿èªAPIç‰¹å®š
- [ ] TASK-002: ç‹¬è‡ªã‚ªãƒ¼ãƒ€ãƒ¼ã‚»ãƒƒãƒˆé¸æŠUI
- [ ] TASK-003: ç—…åã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½
- [ ] TASK-011: henry_karte_history å‡¦æ–¹è¡¨ç¤ºæ”¹å–„ï¼ˆmhlwMedicineå¯¾å¿œã€medicationTimingç”¨æ³•å–å¾—ã€æ¤œä½“æ¤œæŸ»ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ï¼‰
- [ ] TASK-013: Tampermonkeyæ›´æ–°å•é¡Œï¼ˆæ‰‹å‹•æ›´æ–°ã§ã‚‚ã€Œæ›´æ–°ãªã—ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã€‚Violentmonkeyç§»è¡Œã‚’è©¦ã™ï¼‰
- [ ] TASK-015: å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®SPAé·ç§»å¯¾å¿œï¼ˆsubscribeNavigationå°å…¥ï¼‰

### å‹•ä½œç¢ºèªå¾…ã¡
- [ ] TASK-008: henry_error_logger.user.js v1.0.0

### å®Œäº†
- [x] TASK-014: ç”»é¢æ›´æ–°å¦¨å®³ãƒªã‚¹ã‚¯ä¿®æ­£ï¼ˆã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºå‰Šé™¤å®Œäº†ï¼‰
- [x] TASK-009: HenryCore v2.10.4 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè‡ªå‹•å¾©æ—§æ©Ÿèƒ½
- [x] TASK-007: henry_disease_register.user.js v1.2.1
- [x] TASK-010: henry_disease_list.user.js v1.0.2
- [x] TASK-012: henry_disease_register.user.js v2.2.4 æ¤œç´¢ç²¾åº¦æ”¹å–„ï¼ˆN-gramæ¤œç´¢è¿½åŠ ï¼‰
